# PRD Workflow Example: Complete Process with Unresolved Issues

This document demonstrates the complete PRD generation workflow, including the unresolved issues resolution process that maintains the same workflow integrity as the previous REQUEST.md system.

## Step 1: Initial Discussion with Unresolved Issues

When personas cannot reach consensus on key decisions, the system generates an UNRESOLVED_ISSUES.md file instead of a PRD.

### Example Input

```json
{
  "prompt": "Create a user authentication system for my e-commerce platform",
  "outputFormat": "PRD",
  "dynamicRounds": true,
  "consensusConfig": {
    "consensusThreshold": 85,
    "unresolvedIssuesThreshold": 1
  },
  "dryRun": false
}
```

### Generated Output: UNRESOLVED_ISSUES.md

```markdown
---
discussionId: "auth_system_2024-08-25T143022Z"
timestamp: "2024-08-25T14:30:22Z"
language: "en"
totalIssues: 2
---

# Unresolved Issues - User Authentication System

**Discussion ID**: auth_system_2024-08-25T143022Z  
**Generated**: 2024-08-25T14:30:22Z  
**Status**: Requires User Resolution  

## Overview

The roundtable discussion identified **2 unresolved issues** that require your input before generating the final Product Requirements Document (PRD).

---

## Issue 1: Authentication Method Selection

### SolutionsArchitect Position
- [ ] **Use OAuth 2.0 with external providers only (Google, GitHub, Microsoft)**
**Reasoning:** Reduces development complexity and maintenance overhead. Leverages existing, battle-tested authentication infrastructure.

### BusinessStakeholder Position  
- [ ] **Implement custom JWT-based authentication system**
**Reasoning:** Provides full control over user data and can integrate seamlessly with existing customer database and business logic.

### KeyUser Position
- [ ] **Hybrid approach: OAuth for quick signup, custom authentication for power users**
**Reasoning:** Best of both worlds - convenience for most users, advanced features for power users who need custom profiles.

### Additional Options
- [x] **Custom** - I have my own preference (describe below)

**Custom Resolution:**
Use OAuth 2.0 as primary authentication with JWT tokens for session management. Implement Google and GitHub OAuth first, with Microsoft as Phase 2. Custom authentication will be available for enterprise customers only.

---

## Issue 2: Password Requirements and Security

### SolutionsArchitect Position
- [ ] **Enterprise-grade security: 12+ character passwords, MFA required, password rotation every 90 days**
**Reasoning:** Maximum security for e-commerce platform handling financial transactions.

### UXUIDesigner Position
- [ ] **User-friendly approach: 8+ character passwords, optional MFA, no forced rotation**
**Reasoning:** Security shouldn't harm user experience. Many users abandon platforms with overly strict requirements.

### BusinessAnalyst Position  
- [ ] **Balanced approach: 10+ character passwords, MFA for admin accounts only, optional for users**
**Reasoning:** Balances security needs with user adoption. Admins need higher security, regular users need convenience.

### Additional Options
- [ ] **No strong preference** - Any of the above positions is acceptable
- [ ] **Custom** - I have my own preference (describe below)

**Custom Resolution:**
[Please select one option above]

---

## Instructions

1. **Select exactly one option** for each issue by marking `[x]` instead of `[ ]`
2. **Provide custom input** where you selected "Custom"
3. **Save this file** after making your selections
4. **Re-run PentaForge** with the `unresolvedIssuesFile` parameter pointing to this file

### Re-run Command
```bash
# Via MCP tool
{
  "prompt": "Create a user authentication system for my e-commerce platform",
  "outputFormat": "PRD", 
  "unresolvedIssuesFile": "./PRPs/inputs/UNRESOLVED_ISSUES_2024-08-25T143022Z.md",
  "dryRun": false
}
```

---

*Generated by PentaForge MCP Server - Resolve issues above to generate your PRD*
```

## Step 2: User Resolution

The user reviews the file and makes selections:

```markdown
## Issue 1: Authentication Method Selection
- [x] **Custom** - I have my own preference (describe below)

**Custom Resolution:**
Use OAuth 2.0 as primary authentication with JWT tokens for session management. Implement Google and GitHub OAuth first, with Microsoft as Phase 2. Custom authentication will be available for enterprise customers only.

## Issue 2: Password Requirements and Security  
- [x] **Balanced approach: 10+ character passwords, MFA for admin accounts only, optional for users**
```

## Step 3: Final PRD Generation

After resolving issues, the user re-runs PentaForge:

```json
{
  "prompt": "Create a user authentication system for my e-commerce platform",
  "outputFormat": "PRD",
  "unresolvedIssuesFile": "./PRPs/inputs/UNRESOLVED_ISSUES_2024-08-25T143022Z.md", 
  "dryRun": false
}
```

### Generated Output: PRD_2024-08-25T143515Z.md

```markdown
# Product Requirements Document (PRD)

**Timestamp:** 2024-08-25T14:35:15Z  
**Version:** 1.0  
**Author:** PentaForge MCP Server  
**Language:** en

## 1. Overview / Goal

### Problem Statement
Create a user authentication system for my e-commerce platform

### Objectives
- Implement OAuth 2.0 as primary authentication method with Google and GitHub providers
- Provide JWT token-based session management for secure API access
- Enable enterprise customers to use custom authentication methods
- Ensure balanced security approach suitable for e-commerce transactions
- Maintain user-friendly experience while meeting security requirements

### Business Context
E-commerce platform requiring secure user authentication that balances security requirements with user experience. Platform handles financial transactions and customer data, requiring robust security while maintaining ease of use to prevent customer abandonment.

## 2. Scope

### What's Included
- **OAuth 2.0 Integration**: Google and GitHub authentication providers
- **JWT Session Management**: Secure token-based authentication with refresh tokens
- **Enterprise Custom Auth**: Custom authentication option for enterprise customers
- **Balanced Security Model**: 10+ character passwords, MFA for admin accounts
- **User Session Management**: Login, logout, password reset functionality
- **Admin Security Features**: Mandatory MFA for administrative accounts

### What's Excluded  
- **Microsoft OAuth**: Deferred to Phase 2 implementation
- **Biometric Authentication**: Outside current project scope
- **Password Rotation Requirements**: No forced 90-day rotation for regular users
- **Legacy Authentication Systems**: No migration from existing systems in this phase

### Constraints
- Must integrate with existing e-commerce platform database
- OAuth providers must support e-commerce domain restrictions
- JWT tokens must be compatible with existing API infrastructure
- Performance impact on checkout flow must be minimal

## 3. Functional Requirements

### FR001: OAuth 2.0 Authentication
**Priority**: High  
**Category**: Authentication  

**Description**: System must support user authentication via Google and GitHub OAuth 2.0 providers, allowing users to sign up and log in using existing social accounts.

**Acceptance Criteria**:
- Users can sign up using Google OAuth 2.0
- Users can sign up using GitHub OAuth 2.0  
- OAuth flow completes within 10 seconds
- User profile data is correctly mapped from OAuth provider
- Failed OAuth attempts are handled gracefully

**Business Value**: Reduces friction for new user registration and provides trusted authentication mechanism

### FR002: JWT Session Management
**Priority**: High  
**Category**: Authentication

**Description**: System must issue and validate JWT tokens for authenticated sessions, including access tokens and refresh tokens with appropriate expiration times.

**Acceptance Criteria**:
- JWT access tokens expire after 15 minutes
- Refresh tokens expire after 7 days
- Tokens are automatically refreshed without user intervention
- Invalid tokens are rejected with appropriate error messages
- Token revocation is supported for logout

**Business Value**: Provides secure, scalable session management suitable for API-driven e-commerce platform

### FR003: Enterprise Custom Authentication  
**Priority**: Medium  
**Category**: Authentication

**Description**: System must provide custom authentication option for enterprise customers who require integration with their existing identity management systems.

**Acceptance Criteria**:
- Enterprise accounts can be flagged for custom authentication
- Custom authentication API accepts external identity tokens
- Enterprise users can be provisioned programmatically
- Custom authentication integrates with existing user management
- Enterprise authentication events are logged for compliance

**Business Value**: Enables enterprise customer acquisition and supports B2B use cases

### FR004: Balanced Security Password Policy
**Priority**: High  
**Category**: Security

**Description**: System must enforce balanced password security requirements that protect user accounts while maintaining usability.

**Acceptance Criteria**:
- Passwords must be minimum 10 characters long
- Password complexity rules include uppercase, lowercase, numbers
- Admin accounts require Multi-Factor Authentication (MFA)
- Regular users can optionally enable MFA
- Password reset functionality available via email
- Account lockout after 5 failed attempts

**Business Value**: Provides appropriate security for e-commerce platform while maintaining user experience

## 4. Non-Functional Requirements

### Performance
- Authentication response time under 500ms for 95th percentile
- OAuth flow completion under 10 seconds including provider redirects
- JWT validation under 50ms for API requests
- System supports 10,000 concurrent authentication requests

### Security  
- All authentication communications use HTTPS/TLS 1.3
- JWT tokens use RS256 signature algorithm
- Passwords hashed using bcrypt with 12 salt rounds
- OAuth state parameters prevent CSRF attacks
- Rate limiting: 5 authentication attempts per minute per IP

### Scalability
- Authentication service supports horizontal scaling
- JWT validation is stateless and distributable
- Redis-based session storage for high availability
- Database connection pooling for authentication queries

### Usability
- Single sign-on experience across platform
- Clear error messages for authentication failures  
- Mobile-responsive authentication UI
- Accessibility compliance (WCAG 2.1 AA)
- Progressive enhancement for JavaScript-disabled browsers

## 5. User Journey

### New User Registration via OAuth
1. **User** navigates to registration page
2. **User** clicks "Sign up with Google" button
3. **System** redirects to Google OAuth authorization
4. **User** authorizes application access to Google account
5. **System** receives authorization code from Google
6. **System** exchanges code for access token and user profile
7. **System** creates user account with Google profile data
8. **System** issues JWT tokens for authenticated session
9. **User** is redirected to platform dashboard

### Enterprise User Authentication  
1. **Enterprise User** navigates to login page
2. **System** detects enterprise account domain
3. **System** redirects to enterprise authentication endpoint
4. **Enterprise System** validates user credentials
5. **Enterprise System** returns identity token to platform
6. **System** validates enterprise token and creates session
7. **System** issues platform JWT tokens
8. **User** gains access to platform with enterprise permissions

### Admin Login with MFA
1. **Admin User** enters username and password
2. **System** validates credentials successfully  
3. **System** prompts for MFA verification
4. **Admin User** enters TOTP code from authenticator app
5. **System** validates MFA code
6. **System** issues JWT tokens with admin privileges
7. **Admin User** accesses administrative dashboard

## 6. Acceptance Criteria

### AC001: OAuth Authentication Flow
**Scenario**: Successful Google OAuth registration

- **Given**: A new user with a valid Google account
- **When**: They click "Sign up with Google" and complete OAuth flow
- **Then**: They are registered, authenticated, and redirected to dashboard within 30 seconds

### AC002: JWT Token Management
**Scenario**: Automatic token refresh

- **Given**: A user with valid refresh token and expired access token
- **When**: They make an API request requiring authentication
- **Then**: System automatically refreshes access token without requiring re-authentication

### AC003: Enterprise Authentication Integration
**Scenario**: Enterprise user login

- **Given**: An enterprise user with valid corporate credentials
- **When**: They attempt to log in through enterprise authentication
- **Then**: They are authenticated and gain access with appropriate enterprise permissions

### AC004: Security Policy Enforcement  
**Scenario**: Password policy validation

- **Given**: A user attempting to set a new password
- **When**: They enter a password not meeting security requirements
- **Then**: System rejects password with clear guidance on requirements

### AC005: Admin MFA Requirement
**Scenario**: Admin account MFA enforcement

- **Given**: An admin user with correct username and password
- **When**: They attempt to log in without MFA verification
- **Then**: System requires MFA completion before granting admin access

## 7. Stakeholders

### Primary Stakeholders

#### End Users (E-commerce Customers)
**Type**: Primary  
**Influence**: Medium  
**Interest**: High

**Responsibilities**:
- Use authentication system to access platform
- Provide feedback on user experience
- Maintain account security best practices

**Concerns**:
- Quick and easy login process
- Account security and privacy
- Minimal disruption to shopping experience

#### Platform Administrators  
**Type**: Key Decision Maker  
**Influence**: High  
**Interest**: High

**Responsibilities**:
- Manage user accounts and permissions
- Monitor authentication system performance
- Respond to security incidents
- Configure enterprise integrations

**Concerns**:
- System security and compliance
- Administrative tools and visibility
- Integration with existing systems

### Secondary Stakeholders

#### Development Team
**Type**: Secondary  
**Influence**: Medium  
**Interest**: High  

**Responsibilities**:
- Implement authentication features
- Maintain code quality and security
- Integrate with existing platform APIs
- Monitor system performance

**Concerns**:
- Technical feasibility and architecture
- Development timeline and complexity
- Integration with existing codebase

#### Enterprise Customers
**Type**: Primary  
**Influence**: Medium  
**Interest**: Medium

**Responsibilities**:
- Configure enterprise authentication integration  
- Manage enterprise user provisioning
- Ensure compliance with corporate security policies

**Concerns**:
- Integration with existing identity systems
- User provisioning and management
- Compliance and audit requirements

---

## Consensus Summary

**Method**: AI-Driven Dynamic Rounds  
**Rounds Completed**: 4  
**Consensus Achieved**: ✅ Yes  
**Final Agreement Level**: 89%

🎯 **Specification Quality**: High quality due to consensus achieved through adaptive discussion and user resolution of contested issues.

✅ **Completeness**: All major authentication concerns were addressed through structured issue resolution process.

**Key Resolutions**:
- Authentication method: Hybrid OAuth + JWT approach based on user input
- Security level: Balanced approach prioritizing usability without compromising security
- Enterprise support: Custom authentication pathway for B2B customers

---

*Product Requirements Document generated by PentaForge MCP Server*  
*Consensus-based quality: 89% agreement*
```

## Key Workflow Benefits

1. **🔄 Same Workflow**: PRD follows identical unresolved issues workflow as REQUEST.md
2. **🚫 No Incomplete Documents**: PRD only generates when consensus is reached or issues are resolved
3. **✅ User Control**: Users must actively resolve contested points before final document generation
4. **📋 Comprehensive Output**: PRD provides industry-standard requirements documentation
5. **🌐 Bilingual Support**: Works seamlessly in English and Portuguese
6. **🔧 Flexible Configuration**: Supports both legacy REQUEST format and new PRD format

## Workflow Integrity

The PRD transformation maintains complete workflow integrity:

- **Phase 1**: Discussion with consensus evaluation
- **Phase 2**: UNRESOLVED_ISSUES.md generation if needed (same as before)
- **Phase 3**: User resolution required (same as before)
- **Phase 4**: Final document generation only after resolution (same as before)

**The only change**: The final document is now a comprehensive PRD instead of REQUEST.md, but the entire workflow and user experience remains identical.